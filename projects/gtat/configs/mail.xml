<?xml version="1.0"?>
<ESCALATION title="GTA Mail" processdelay="2"
	host="mail.openbaraza.org" mailuser="hcm.openbaraza" mailpassword="hcm_invent"  mailfrom="info@openbaraza.org" 
	inbox="INBOX" sentbox="INBOX.Sent" smtppauth="true"
	reportpath="/opt/baraza/projects/gtat/reports/">

	<REPORT name="Invoice" keyfield="sys_emailed_id" action="Emailed" actioncount="1" 
			table="sys_emails, sys_emailed, clients, invoicelist"
			where="( (clients.clientid = invoicelist.clientid) AND (invoicelist.invoiceid = sys_emailed.table_id) AND(sys_emailed.emailed = false)  AND (sys_emails.sys_email_id = sys_emailed.sys_email_id) AND (sys_emailed.email_type = 1))">
		<SUBJECT title="subject">sys_emails.title</SUBJECT>
		<PARAM basetable="invoicelist" >invoiceid</PARAM>
		<ADDRESS title="address" >clients.email</ADDRESS>
		<BODYFIELD reference="{{clientname}}" basetable="clients">clientname</BODYFIELD>
		<FIELD title="Body" basetable="sys_emails">details</FIELD>
 		<REPORT fnct="'invoice_e.jasper'::varchar">invoice_file</REPORT>
	</REPORT>

	<REPORT name="Credit Note" keyfield="sys_emailed_id" action="Emailed" actioncount="1" 
			table="sys_emails, sys_emailed, clients, crnotelist"
			where="( (clients.clientid = crnotelist.clientid) AND (crnotelist.crnoteid = sys_emailed.table_id) AND (sys_emailed.emailed = false)  AND (sys_emails.sys_email_id = sys_emailed.sys_email_id) AND (sys_emailed.email_type = 2))">
		<SUBJECT title="subject">sys_emails.title</SUBJECT>
		<PARAM basetable="crnotelist" >crnoteid</PARAM>
		<ADDRESS title="address" >clients.email</ADDRESS>
		<BODYFIELD reference="{{clientname}}" basetable="clients">clientname</BODYFIELD>
		<FIELD title="Body" basetable="sys_emails">details</FIELD>
		<REPORT fnct="'creditnote_e.jasper'::varchar">crnote_file</REPORT>
	</REPORT>
	
</ESCALATION>
